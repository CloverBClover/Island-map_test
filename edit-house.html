<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Edit House</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 {
      margin-bottom: 10px;
    }
    #inventory, #placed {
      background: white;
      border-radius: 8px;
      padding: 15px;
      width: 320px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    #inventory h2, #placed h2 {
      margin-top: 0;
    }
    .furniture-item {
      display: flex;
      justify-content: space-between;
      margin: 6px 0;
    }
    button.place-btn {
      margin-left: 8px;
      padding: 4px 10px;
      cursor: pointer;
      background: #0077cc;
      border: none;
      color: white;
      border-radius: 5px;
      font-weight: bold;
      transition: background 0.3s ease;
    }
    button.place-btn:disabled {
      background: #aaa;
      cursor: not-allowed;
    }
    .placed-item {
      display: flex;
      justify-content: space-between;
      margin: 6px 0;
    }
    button.remove-btn {
      background: #cc4444;
      border: none;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      padding: 3px 8px;
      font-weight: bold;
      transition: background 0.3s ease;
    }
    button.remove-btn:hover {
      background: #aa0000;
    }
    #back-btn {
      padding: 10px 20px;
      background: #555;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s ease;
    }
    #back-btn:hover {
      background: #333;
    }
  </style>
</head>
<body>
  <h1>Edit Your House</h1>

  <div id="inventory">
    <h2>Furniture Inventory</h2>
    <!-- Inventory items will be populated here -->
  </div>

  <div id="placed">
    <h2>Placed Furniture</h2>
    <!-- Placed furniture will be listed here -->
  </div>

  <button id="back-btn">Back to Profile</button>

  <script>
    // Helper: pad numbers with leading zeros
    function padNumber(num, length) {
      return num.toString().padStart(length, '0');
    }

    // Get logged in user data from localStorage
    const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
    if (!loggedInUser || !loggedInUser.username) {
      alert("You must be logged in to edit your house.");
      window.location.href = "index.html";
    }

    const users = JSON.parse(localStorage.getItem('users')) || [];
    const userIndex = users.findIndex(u => u.username === loggedInUser.username);
    if (userIndex === -1) {
      alert("User not found.");
      window.location.href = "index.html";
    }
    const user = users[userIndex];

    // Ensure user has inventory object, if not create empty furniture inventory
    if (!user.inventory) user.inventory = {};
    if (!user.inventory.furniture) user.inventory.furniture = {};

    // Initialize placedFurniture object (furniture name => count)
    if (!user.placedFurniture) user.placedFurniture = {};

    // DOM refs
    const inventoryDiv = document.getElementById('inventory');
    const placedDiv = document.getElementById('placed');
    const backBtn = document.getElementById('back-btn');

    // Update UI for inventory and placed furniture
    function render() {
      // Clear existing
      inventoryDiv.innerHTML = '<h2>Furniture Inventory</h2>';
      placedDiv.innerHTML = '<h2>Placed Furniture</h2>';

      // List inventory items with place buttons
      const furnitureKeys = Object.keys(user.inventory.furniture);
      if (furnitureKeys.length === 0) {
        inventoryDiv.innerHTML += '<p>No furniture in inventory.</p>';
      } else {
        furnitureKeys.forEach(furn => {
          const totalOwned = user.inventory.furniture[furn] || 0;
          const placedCount = user.placedFurniture[furn] || 0;
          const available = totalOwned - placedCount;

          const itemDiv = document.createElement('div');
          itemDiv.className = 'furniture-item';

          const label = document.createElement('span');
          label.textContent = `${furn} (Owned: ${totalOwned}, Available: ${available})`;

          const btn = document.createElement('button');
          btn.className = 'place-btn';
          btn.textContent = 'Place';
          btn.disabled = available <= 0;
          btn.onclick = () => {
            placeFurniture(furn);
          };

          itemDiv.appendChild(label);
          itemDiv.appendChild(btn);
          inventoryDiv.appendChild(itemDiv);
        });
      }

      // List placed furniture with remove buttons
      const placedKeys = Object.keys(user.placedFurniture);
      if (placedKeys.length === 0) {
        placedDiv.innerHTML += '<p>No furniture placed.</p>';
      } else {
        placedKeys.forEach(furn => {
          const count = user.placedFurniture[furn];
          if (count > 0) {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'placed-item';

            const label = document.createElement('span');
            label.textContent = `${furn}: ${count}`;

            const btn = document.createElement('button');
            btn.className = 'remove-btn';
            btn.textContent = 'Remove';
            btn.onclick = () => {
              removeFurniture(furn);
            };

            itemDiv.appendChild(label);
            itemDiv.appendChild(btn);
            placedDiv.appendChild(itemDiv);
          }
        });
      }
    }

    function placeFurniture(furn) {
      const totalOwned = user.inventory.furniture[furn] || 0;
      const placedCount = user.placedFurniture[furn] || 0;
      if (placedCount < totalOwned) {
        user.placedFurniture[furn] = placedCount + 1;
        saveUser();
        render();
      } else {
        alert(`You cannot place more ${furn} than you own.`);
      }
    }

    function removeFurniture(furn) {
      const placedCount = user.placedFurniture[furn] || 0;
      if (placedCount > 0) {
        user.placedFurniture[furn] = placedCount - 1;
        saveUser();
        render();
      }
    }

    function saveUser() {
      users[userIndex] = user;
      localStorage.setItem('users', JSON.stringify(users));
    }

    backBtn.addEventListener('click', () => {
      // Redirect back to your profile page (with correct ID)
      const profileId = padNumber(userIndex + 1, 5);
      window.location.href = `profile.html?id=${profileId}`;
    });

    // Initial render
    render();
  </script>
</body>
</html>
